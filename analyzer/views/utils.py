import mimetypes
from django.http import HttpResponse

from analyzer.models import Sandbox
from analyzer.models.report import Report


# STATUS: OK
def get_file_in_response(content, file_path, file_name):
    mime_type = mimetypes.guess_type(file_path)
    response = HttpResponse(content, content_type=mime_type)
    response["Content-Disposition"] = "attachment; filename=%s" % file_name
    return response


# STATUS OK
def get_sandbox_report(report: Report, sandbox):
    summaries = report.scans.all()
    if sandbox == "cuckoo":
        return summaries.get(sandbox=Sandbox.CUCKOO)
    elif sandbox == "virus-total":
        return summaries.get(sandbox=Sandbox.VIRUS_TOTAL)
    else:
        return summaries.get(sandbox=Sandbox.COMBINED)
