from analyzer.api.utils import check_if_key_exists
from analyzer.models import Summary
from analyzer.models.process import Process


# STATUS OK
def save_process(dict_process: dict):
    uid = dict_process['uid']
    parent_uid = check_if_key_exists(dict_process, 'parentuid')
    name = dict_process['name']
    normalized_path = dict_process['normalized_path']
    command_Line = dict_process['command_line']
    SHA256 = dict_process['sha256']

    process, created = Process.objects.get_or_create(uid=uid, parent_uid=parent_uid, name=name,
                                                     normalized_path=normalized_path, cmd_line=command_Line,
                                                     SHA256=SHA256)
    return process


def save_processes(overview: Summary, processes: dict):
    for process in processes:
        process_row = save_process(process)
        overview.processes.add(process_row)
