from django.core.files.base import ContentFile
import base64
from analyzer.models.screeshot import Screenshot


def decode_base_64_file(file_name, image):
    try:
        decoded_file = base64.b64decode(image)
    except TypeError:
        TypeError('invalid_image')

    return ContentFile(decoded_file, name=file_name)


def save_screenshot(screenshot):
    file_name = screenshot['name']
    image = screenshot['image']
    decoded_image = decode_base_64_file(file_name, image)
    #fix here
    screenshot_row,created = Screenshot.objects.get_or_create(name=file_name, image=decoded_image)
    return screenshot_row


def save_screenshots(overview, screenshots):
    for screenshot in screenshots:
        screenshot_row = save_screenshot(screenshot)
        overview.screenshots.add(screenshot_row)
