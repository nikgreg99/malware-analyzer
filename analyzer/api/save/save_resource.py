from analyzer.models import Overview
from analyzer.models.resource import Resource


def save_resource_if_not_exists(dict_resource: dict):
    type = dict_resource['type']
    name = dict_resource['name']
    id = dict_resource['id']
    rva = dict_resource['rva']
    file_rva = dict_resource['fileRva']
    size = dict_resource['size']
    SHA256 = dict_resource['sha256']
    file_description = dict_resource['fileMagicDescription']
    lang = dict_resource['lang']
    sub_lang = dict_resource['sublang']

    resource, created = Resource.objects.get_or_create(type=type, name=name, id_resource=id, rva=rva,
                                                       file_rva=file_rva, size=size, SHA256=SHA256,
                                                       file_description=file_description, lang=lang, sublang=sub_lang)

    return resource


def save_resources(overview: Overview, dict_resources):
    for dict_resource in dict_resources:
        resource = save_resource_if_not_exists(dict_resource)
        overview.resources.add(resource)
