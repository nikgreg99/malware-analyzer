from analyzer.models.antivirus import Antivirus


def save_antivirus(analysis_result):
    category = analysis_result['category']
    engine_name = analysis_result['engine_name']
    engine_version = analysis_result['engine_version'] if 'engine_version' in analysis_result else ''
    result = analysis_result['result']
    method = analysis_result['method']

    antivirus, created = Antivirus.objects.get_or_create(engine_name=engine_name, engine_version=engine_version,
                                                         verdict=category, result=result, method=method)
    return antivirus


def save_antivirus_analysis(overview, analysis_results):
    for engine_key in analysis_results.keys():
        antivirus = save_antivirus(analysis_results[engine_key])
        overview.antivirus.add(antivirus)
