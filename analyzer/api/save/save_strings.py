from analyzer.models import String, Overview


def save_string_if_not_exists(dict_string: dict):
    str = dict_string['str']
    type = dict_string['type']
    offset = dict_string['metaData']['offset']

    string = String.objects.all().filter(name=str, type=type, offset=offset)
    if not string.exists():
        string = String(name=dict_string['str'], type=dict_string['type'], offset=dict_string['metaData']['offset'])
        string.save()
    else:
        string = string.get()
    return string


def save_strings(overview: Overview, dict_strings):
    for dict_string in dict_strings:
        string = save_string_if_not_exists(dict_string)
        overview.strings.add(string)
