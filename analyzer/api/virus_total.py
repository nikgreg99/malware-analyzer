import vt
from storage import uploads_storage


class VirusTotalAPI(object):

    def __init__(self, api_key):
        self.client = vt.Client(api_key)

    def submit_file(self, file_name: str):
        file = uploads_storage.open(file_name, "rb")
        analysis = self.client.scan_file(file)
        return analysis

    def submit_url(self, url: str):
        analysis = self.client.scan_url(url)
        return analysis

    def get_analyse(self, analyse_id):
        while True:
            analysis = self.client.get_object("/analyses/{}", analyse_id)
            if analysis.status == "completed":
                break
        return analysis

