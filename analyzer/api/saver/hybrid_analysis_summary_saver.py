from analyzer.api.saver.summary_saver import SummarySaver
from analyzer.api.wrapper import hybrid_analysis
from analyzer.models import Target, Analyse, Sandbox


class HybridAnalysisSummarySaver(SummarySaver):
    def save_summary(self, target: Target, response):
        job_id = response["job_id"]
        json_analyse = hybrid_analysis.report_id_summary(job_id)
        target_id = target.id
        size = json_analyse['size']
        type = json_analyse['type_short']
        MD5 = json_analyse['md5']
        SHA1 = json_analyse['sha1']
        SHA256 = json_analyse['sha256']
        SHA512 = json_analyse['sha512']
        analyse_start_time = json_analyse['analysis_start_time']
        analyse = Analyse(sandbox=Sandbox.HYBRID_ANALYSIS,
                          size=size,
                          type=type,
                          job_id=job_id,
                          MD5=MD5,
                          SHA1=SHA1,
                          SHA256=SHA256,
                          SHA512=SHA512,
                          analyse_start_time=analyse_start_time,
                          target=Target.objects.get(id=target_id))
        analyse.save()
        return analyse
