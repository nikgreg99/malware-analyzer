from django.test import TestCase
from django.test import Client
from django.utils import timezone
from django.urls import reverse
from analyzer.models import Target, TargetType, Analyse


def create_fake_analyse(target_name, target_type):
    target = Target.objects.create(name=target_name, type=target_type)
    datetime = timezone.now()
    return Analyse.objects.create(target_id=target.id, size=20, type="Fake file", analyse_start_time=datetime)


class IndexViewTest(TestCase):
    client = Client()

    def test_no_analysis(self):
        response = self.client.get(reverse('analyzer:index'))
        self.assertEqual(response.status_code, 200)
        self.assertQuerysetEqual(response.context["analysis"], [])

    def test_with_analysis(self):
        fake_analyse = create_fake_analyse("fake.exe", TargetType.FILE)
        response = self.client.get(reverse('analyzer:index'))
        self.assertEqual(response.status_code, 200)
        self.assertQuerysetEqual(response.context["analysis"], [fake_analyse])
