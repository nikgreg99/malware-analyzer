{% extends "analyzer/report.html" %}
{% load static %}
{% block metas %}
    <meta name="description" content="Analyse{{ overview.id }} - Overview">
    <meta name="keywords" content="analysis, overview">
    <title>Analyse {{ overview.id }} - Overview</title>
{% endblock %}
{% block content %}
    <div class="col-xl-9">
        <div class="card report-block">
            <div class="card-body">
                <h2 class="wrapper card-title">
                    <span class="text">General Info</span>
                </h2>
                <div class="d-flex">
                    <span class="label fw-bold">Name: &nbsp;</span>
                    <span class="text">{{ overview.target.name }}</span>
                </div>
                <div class="d-flex">
                    <span class="label fw-bold">Target type: &nbsp;</span>
                    <span class="text"> {{ overview.target.type }}</span>
                </div>
                <div class="d-flex">
                    <span class="label fw-bold"> Job id: &nbsp;</span>
                    <span class="text"> {{ overview.job_id }}</span>
                    <span data-bs-toggle="tooltip" data-bs-placement="right" title="Depends on sandbox ">
                            &nbsp;&nbsp;
                            <i class="bi bi-info-circle-fill"></i>
                        </span>
                </div>
                <div class="d-flex">
                    <span class="label fw-bold">Type: &nbsp;</span>
                    <span class="text">{{ overview.type }}</span>
                </div>
                <div class="d-flex ">
                    <span class="label fw-bold">Sandbox: &nbsp; </span>
                    <span class="text">{{ overview.sandbox }}</span>
                </div>
                <div class="d-flex ">
                    <span class="label fw-bold">Submission time: &nbsp;</span>
                    <span class="text">{{ overview.submission_time }}</span>
                </div>
                {% if overview.SHA256 %}
                    <div class="d-flex">
                    <span class="label fw-bold">SHA-256: &nbsp; </span>
                    <span class="text">{{ overview.SHA256 }}</span>
                {% endif %}
            </div>
        </div>
        <div class="d-grid gap-2 d-md-block" style="margin-left: 16px; margin-bottom: 8px">
            {% if overview.sandbox == "FileS_Scan_IO" %}
            <a role="button" class="btn btn-outline-dark btn-sm  btn btn-outline-dark"
               href="{% url 'analyzer:downloadFile' overview.pk %}">
                &nbsp;&nbsp;
                Download sample
                <span class="caret"></span>
            </a>
            {% endif %}
            <button type="button"
                    class="btn btn-outline-dark btn-sm dropdown-toggle btn-btn-outline-dark button-spacer"
                    data-bs-toggle="dropdown" aria-expanded="false">
                &nbsp;
                Download report
                <i class="bi bi-download"></i>
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                {% for report_format in report_formats %}
                    <li class="dropdown-item">
                        <a class="" href="{% url 'analyzer:downloadReport' overview.id report_format %}">
                            as {{ report_format|upper }}</a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    </div>
    </div>
    {% if overview.screenshots.count > 0 %}
         <div class="col-xl-9" style="margin-left: 15.7em">
        <div class="card report-block">
            <div class="card-body">
                <h2 class="wrapper card-title">
                    <span class="text">Analysis Screenshots </span>
                </h2>
                <div class="col-xl-6">
                     <div id="screenshotSlideShow" class="carousel slide" data-bs-ride="true">
                        <div class="carousel-indicators">
                            {% for screenshot in screenshots %}
                                {% if forloop.counter0 == 0 %}
                                    <button type="button" data-bs-target="#screenshotSlideShow"
                                            data-bs-slide-to="{{ forloop.counter0 }}"
                                                    class="active" aria-current="true"
                                            aria-label="Screen{{ forloop.counter0 }}"></button>
                                {% else %}
                                    <button type="button" data-bs-target="#screenshotSlideShow"
                                            data-bs-slide-to="{{ forloop.counter0 }}"
                                            aria-label="Screen{{ forloop.counter0 }}"></button>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="carousel-inner">
                            {% for screenshot in screenshots %}
                                {% if forloop.counter0 == 0 %}
                                    <div class="carousel-item active" data-bs-interval="10000">
                                        <img src="{{ screenshot.image.url }}" class="d-block w-100 h-50"
                                             alt="{{ screenshot.image.url }}"/>
                                    </div>
                                {% else %}
                                    <div class="carousel-item" data-bs-interval="10000">
                                        <img src="{{ screenshot.image.url }}" class="d-block w-100 h-50"
                                             alt="{{ screenshot.image.url }}"/>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#screenshotSlideShow"
                                data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#screenshotSlideShow"
                                data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>
                </div>
                </div>
            </div>
        </div>
    {% endif %}
        {% if overview.mitre_attacks.count > 0 %}
             <div class="col-xl-9">
            <div class="card report-block">
                <div class="card-body">
                    <h2 class="wrapper card-title">
                        <span class="title">Mitre Techniques</span>
                    </h2>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th scope="col">Tactic</th>
                                    <th scope="col">Technique</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for mitre_attack in overview.mitre_attacks.all %}
                                    <tr scope="row">
                                        <td> {{ mitre_attack.tactic }}</td>
                                        <td> <a class="nav-link active" href="{{ mitre_attack.attack_id_wiki }}">
                                            {{ mitre_attack.technique }}
                                        </a></td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </h2>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
{% endblock %}