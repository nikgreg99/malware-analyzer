const isAdvancedUpload = function () {
    const div = document.createElement('div');
    return (('draggable' in div) || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;
}();

const form = $('.box');

let droppedFiles = false;


$(function (){
        form.on('submit', function (e) {
    if (form.hasClass('box-is-uploading')) return false;

    form.addClass('box-is-uploading').removeClass('box-is-error');

    if (isAdvancedUpload) {
        droppedFiles = false;
        e.preventDefault();
        if(droppedFiles){
            $.each(droppedFiles, function (input,file){
                ajaxFile.append(input.attr('name'),file);
            })
        }
        const ajaxFile = new FormData(form.get(0));

        $.ajax({
            url: form.attr('action'),
            method: form.attr('method'),
            data: ajaxFile,
            cache: false,
            contentType: false,
            processData: false,
            complete: function () {
                form.removeClass('box-is-uploading');
            },
            success: function (data) {
                form.addClass( data.success === true ? 'box-is-success' : 'box-is-error' );
            },
            error: function (data) {
                console.log('Error Ajax Request')
            }
        })

    }

})
    .on('drop', function (e) {
        droppedFiles = e.originalEvent.dataTransfer.files;
        console.log('file submitted');
        form.trigger('submit');
    })


});

